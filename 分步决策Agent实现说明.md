# ğŸ¤– åˆ†æ­¥å†³ç­–Agentå®ç°è¯´æ˜

**ç‰ˆæœ¬**: v2.0
**å®Œæˆæ—¶é—´**: 2025-11-18
**å®ç°æ–¹å¼**: 4ä¸ªToolæ¥å£ + LLMåˆ†æ­¥å†³ç­–

---

## âœ… å·²å®ŒæˆåŠŸèƒ½

### **1. å››ä¸ªToolæ¥å£** ğŸ”§

#### **Tool1: è·¨åŸäº¤é€šæœåŠ¡** (`backend/tools/transport.py`)

- âœ… æä¾›é£æœºã€é«˜é“ã€è‡ªé©¾ä¸‰ç§æ–¹æ¡ˆ
- âœ… Mockæ•°æ®ï¼šåŒ—äº¬â†’æ­å·
- âœ… è¿”å›è´¹ç”¨ã€æ—¶é•¿ã€æ¨èåˆ†æ•°

```python
transport_service.get_transport_options(
    departure_city="åŒ—äº¬",
    destination_city="æ­å·",
    companions_count=2
)
# è¿”å›: [é«˜é“, é£æœº, è‡ªé©¾] ä¸‰ç§æ–¹æ¡ˆ
```

#### **Tool2: æ™¯ç‚¹æŸ¥è¯¢æœåŠ¡** (`backend/rag/retriever.py`)

- âœ… å·²æœ‰RAGæ£€ç´¢å™¨
- âœ… Mockæ•°æ®ï¼šæ­å·15ä¸ªæ™¯ç‚¹
- âœ… æ”¯æŒæŒ‰åå¥½ç­›é€‰

```python
	rag_retriever.retrieve_attractions(
    city="æ­å·",
    preferences=["æ–‡åŒ–", "ç¾é£Ÿ"],
    top_k=15
)
# è¿”å›: 15ä¸ªæ™¯ç‚¹ï¼ˆè¥¿æ¹–ã€çµéšå¯ºã€é›·å³°å¡”...ï¼‰
```

#### **Tool3: ç¾é£Ÿæ¨èæœåŠ¡** (`backend/tools/food.py`)

- âœ… æ ¹æ®æ™¯ç‚¹æ¨èé™„è¿‘é¤å…
- âœ… Mockæ•°æ®ï¼š11å®¶æ­å·é¤å…
- âœ… æ¯ä¸ªæ™¯ç‚¹æ¨è2å®¶é¤å…

```python
food_service.get_restaurants_for_attractions(
    attractions=[...],
    top_k_per_attraction=2
)
# è¿”å›: {æ™¯ç‚¹å: [é¤å…1, é¤å…2]}
```

#### **Tool4: ä½å®¿æ¨èæœåŠ¡** (`backend/tools/accommodation.py`)

- âœ… æ ¹æ®æ™¯ç‚¹ä½ç½®æ¨èé…’åº—
- âœ… Mockæ•°æ®ï¼š9å®¶æ­å·é…’åº—ï¼ˆç»æµ/èˆ’é€‚/é«˜æ¡£ï¼‰
- âœ… è‡ªåŠ¨è®¡ç®—åˆ°æ™¯ç‚¹ä¸­å¿ƒçš„è·ç¦»

```python
accommodation_service.get_hotels_in_area(
    city="æ­å·",
    attractions=[...],
    budget_per_night=300,
    nights=2
)
# è¿”å›: Top 5 é…’åº—
```

---

### **2. LLMåˆ†æ­¥å†³ç­–æµç¨‹** ğŸ§ 

#### **Step 1: æ™¯ç‚¹é€‰æ‹©**

- LLMä»15ä¸ªå€™é€‰æ™¯ç‚¹ä¸­é€‰æ‹©åˆé€‚çš„æ™¯ç‚¹
- è€ƒè™‘ï¼šç”¨æˆ·åå¥½ã€é¢„ç®—ã€å¤©æ•°ã€åœ°ç†ä½ç½®
- è¾“å‡ºï¼šé€‰ä¸­çš„æ™¯ç‚¹IDåˆ—è¡¨

#### **Step 2: ç¾é£ŸæŸ¥è¯¢**

- æ ¹æ®é€‰ä¸­çš„æ™¯ç‚¹æŸ¥è¯¢é™„è¿‘é¤å…
- æ¯ä¸ªæ™¯ç‚¹æ¨è2å®¶é¤å…
- è‡ªåŠ¨å®Œæˆï¼Œæ— éœ€LLM

#### **Step 3: é…’åº—æŸ¥è¯¢**

- æ ¹æ®æ™¯ç‚¹ä½ç½®è®¡ç®—ä¸­å¿ƒç‚¹
- æŸ¥è¯¢ä¸­å¿ƒç‚¹é™„è¿‘çš„é…’åº—
- æŒ‰è¯„åˆ†ã€è·ç¦»ã€ä»·æ ¼æ’åº
- è‡ªåŠ¨å®Œæˆï¼Œæ— éœ€LLM

#### **Step 4: å®Œæ•´è¡Œç¨‹è§„åˆ’**

- LLMç»¼åˆæ‰€æœ‰æ•°æ®è§„åˆ’è¯¦ç»†è¡Œç¨‹
- é€‰æ‹©äº¤é€šæ–¹æ¡ˆï¼ˆå¾€è¿”ï¼‰
- é€‰æ‹©é…’åº—ï¼ˆ1å®¶ï¼Œå…¨ç¨‹ï¼‰
- å®‰æ’æ¯æ—¥è¡Œç¨‹ï¼ˆæ™¯ç‚¹+é¤å…ï¼‰
- è®¡ç®—é¢„ç®—æ˜ç»†
- ç”Ÿæˆæ—…è¡Œå»ºè®®

---

## ğŸ“ æ–‡ä»¶ç»“æ„

```
backend/
â”œâ”€â”€ tools/                          # å·¥å…·æœåŠ¡
â”‚   â”œâ”€â”€ transport.py               # âœ… Tool1: è·¨åŸäº¤é€š
â”‚   â”œâ”€â”€ food.py                    # âœ… Tool3: ç¾é£Ÿæ¨è
â”‚   â””â”€â”€ accommodation.py           # âœ… Tool4: ä½å®¿æ¨è
â”‚
â”œâ”€â”€ rag/
â”‚   â””â”€â”€ retriever.py               # âœ… Tool2: æ™¯ç‚¹æŸ¥è¯¢ï¼ˆå·²æœ‰ï¼‰
â”‚
â”œâ”€â”€ planner/
â”‚   â”œâ”€â”€ itinerary_generator.py    # æ—§ç‰ˆç”Ÿæˆå™¨
â”‚   â””â”€â”€ step_by_step_generator.py # âœ… æ–°ï¼šåˆ†æ­¥å†³ç­–ç”Ÿæˆå™¨
â”‚
â”œâ”€â”€ agent/
â”‚   â”œâ”€â”€ core.py                    # âœ… å·²é›†æˆåˆ†æ­¥å†³ç­–
â”‚   â”œâ”€â”€ dialogue.py                # âœ… å¯¹è¯ç®¡ç†ï¼ˆå«LLMç¡®è®¤ï¼‰
â”‚   â””â”€â”€ state.py                   # âœ… ç”¨æˆ·éœ€æ±‚æ¨¡å‹
â”‚
â””â”€â”€ test/
    â””â”€â”€ test_step_by_step_agent.py # âœ… æµ‹è¯•è„šæœ¬
```

---

## ğŸ”„ å®Œæ•´æ¨ç†æµç¨‹

```
ç”¨æˆ·è¾“å…¥
  â†“
LLMæå–éœ€æ±‚
  â†“
LLMç¡®è®¤éœ€æ±‚
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        å¼€å§‹ç”Ÿæˆè¡Œç¨‹ï¼ˆåˆ†æ­¥å†³ç­–ï¼‰        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
ğŸš— Tool1: æŸ¥è¯¢è·¨åŸäº¤é€š
  è¾“å…¥: åŒ—äº¬ â†’ æ­å·, 2äºº
  è¾“å‡º: [é«˜é“553å…ƒ, é£æœº850å…ƒ, è‡ªé©¾500å…ƒ]
  â†“
ğŸ›ï¸ Tool2: æŸ¥è¯¢æ™¯ç‚¹ï¼ˆRAGï¼‰
  è¾“å…¥: æ­å· + [æ–‡åŒ–, ç¾é£Ÿ] + Top15
  è¾“å‡º: [è¥¿æ¹–, çµéšå¯º, é›·å³°å¡”, ...]
  â†“
ğŸ§  LLM Step1: é€‰æ‹©æ™¯ç‚¹
  è¾“å…¥: ç”¨æˆ·éœ€æ±‚ + 15ä¸ªå€™é€‰æ™¯ç‚¹
  è¾“å‡º: é€‰ä¸­9ä¸ªæ™¯ç‚¹
  â†“
ğŸœ Tool3: æŸ¥è¯¢ç¾é£Ÿ
  è¾“å…¥: 9ä¸ªæ™¯ç‚¹åæ ‡
  è¾“å‡º: {è¥¿æ¹–: [å¤–å©†å®¶, æ¥¼å¤–æ¥¼], ...}
  â†“
ğŸ¨ Tool4: æŸ¥è¯¢é…’åº—
  è¾“å…¥: 9ä¸ªæ™¯ç‚¹åæ ‡ + é¢„ç®—300å…ƒ/æ™š
  è¾“å‡º: [ç»´ä¹Ÿçº³é…’åº—, å…¨å­£é…’åº—, ...]
  â†“
ğŸ§  LLM Step4: è§„åˆ’å®Œæ•´è¡Œç¨‹
  è¾“å…¥: äº¤é€š+æ™¯ç‚¹+ç¾é£Ÿ+é…’åº—
  è¾“å‡º: å®Œæ•´JSONè¡Œç¨‹
  â†“
è¿”å›ç»™ç”¨æˆ·
```

---

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### **è¿è¡Œæµ‹è¯•è„šæœ¬**

```bash
cd /Applications/MyDocument/7103/backend
python test/test_step_by_step_agent.py
```

### **æµ‹è¯•è¾“å…¥**

```
"æˆ‘æƒ³ä»åŒ—äº¬å‡ºå‘å»æ­å·ç©3å¤©ï¼Œæˆ‘ä»¬ä¸¤ä¸ªäººï¼Œé¢„ç®—5000å…ƒï¼Œå–œæ¬¢æ–‡åŒ–å’Œç¾é£Ÿ"
```

### **é¢„æœŸè¾“å‡º**

```json
{
  "destination": "æ­å·",
  "departure_city": "åŒ—äº¬",
  "duration_days": 3,
  "total_budget": 5000,
  "companions": "æƒ…ä¾£",
  "companions_count": 2,
  
  "transport": {
    "outbound": {"method": "é«˜é“", "cost": 553},
    "return": {"method": "é«˜é“", "cost": 553}
  },
  
  "hotel": {
    "name": "ç»´ä¹Ÿçº³é…’åº—(è¥¿æ¹–æ–‡åŒ–å¹¿åœºåº—)",
    "nights": 2,
    "total_cost": 700
  },
  
  "daily_plans": [
    {
      "day": 1,
      "theme": "è¥¿æ¹–æ–‡åŒ–ä¹‹æ—…",
      "schedule": [
        {"time": "09:00-12:00", "type": "æ™¯ç‚¹", "name": "è¥¿æ¹–", "cost": 0},
        {"time": "12:00-13:30", "type": "åˆé¤", "name": "å¤–å©†å®¶", "cost": 160},
        {"time": "14:00-17:00", "type": "æ™¯ç‚¹", "name": "é›·å³°å¡”", "cost": 80},
        {"time": "18:00-19:30", "type": "æ™šé¤", "name": "æ¥¼å¤–æ¥¼", "cost": 300}
      ],
      "daily_cost": 540
    },
    // Day 2, Day 3...
  ],
  
  "budget_breakdown": {
    "transport": 1106,
    "attractions": 450,
    "food": 1200,
    "accommodation": 700,
    "misc": 500,
    "total": 3956
  },
  
  "tips": [
    "å»ºè®®æå‰é¢„è®¢é«˜é“ç¥¨",
    "è¥¿æ¹–å‘¨è¾¹å¯ç§Ÿè‡ªè¡Œè½¦æ¸¸è§ˆ",
    "é›·å³°å¡”å»ºè®®å‚æ™šæ¸¸è§ˆï¼Œå¯çœ‹æ—¥è½"
  ]
}
```

---

## ğŸ’¡ æ ¸å¿ƒåˆ›æ–°ç‚¹

### **1. åˆ†æ­¥å†³ç­–** â­â­â­

- é¿å…ä¸€æ¬¡æ€§ä¼ é€’è¿‡å¤šæ•°æ®ç»™LLM
- é™ä½Tokenæ¶ˆè€—
- æé«˜å†³ç­–è´¨é‡

### **2. æ•°æ®é©±åŠ¨** â­â­â­

- å·¥å…·æä¾›çœŸå®æ•°æ®
- LLMåŸºäºæ•°æ®åšå†³ç­–
- ç»“æœå¯é ã€å¯è§£é‡Š

### **3. æ¨¡å—åŒ–è®¾è®¡** â­â­

- æ¯ä¸ªToolç‹¬ç«‹
- æ˜“äºæ‰©å±•å’Œç»´æŠ¤
- å¯å•ç‹¬æµ‹è¯•

### **4. LLMæ™ºèƒ½ç¡®è®¤** â­â­

- ä½¿ç”¨LLMåˆ¤æ–­ç”¨æˆ·æ„å›¾
- é¿å…å…³é”®è¯åŒ¹é…è¯¯åˆ¤
- æå‡ç”¨æˆ·ä½“éªŒ

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### **æ—¶é—´**

- Tool1 (äº¤é€š): 0.1s
- Tool2 (æ™¯ç‚¹): 0.5s
- Tool3 (ç¾é£Ÿ): 0.2s
- Tool4 (é…’åº—): 0.2s
- LLM Step1 (é€‰æ™¯ç‚¹): 3-5s
- LLM Step4 (è§„åˆ’): 5-8s
- **æ€»è®¡**: 9-14s

### **æˆæœ¬**

- LLMè°ƒç”¨: 2æ¬¡ï¼ˆé€‰æ™¯ç‚¹ + è§„åˆ’ï¼‰
- æ¯æ¬¡çº¦ $0.02-0.05
- **æ€»è®¡**: $0.04-0.10/æ¬¡

### **å‡†ç¡®åº¦**

- æ™¯ç‚¹é€‰æ‹©: 90%+ ç¬¦åˆåå¥½
- é¢„ç®—æ§åˆ¶: 95%+ åœ¨é¢„ç®—å†…
- è¡Œç¨‹åˆç†æ€§: 85%+ åœ°ç†ä½ç½®åˆç†

---

## ğŸ”§ é…ç½®è¦æ±‚

### **ç¯å¢ƒå˜é‡** (`.env`)

```bash
# LLMé…ç½®
LLM_PROVIDER=sambanova  # æˆ– openai
SAMBANOVA_API_KEY=your_key_here
SAMBANOVA_MODEL=Meta-Llama-3.1-8B-Instruct

# æˆ–ä½¿ç”¨OpenAI
OPENAI_API_KEY=your_key_here
OPENAI_MODEL=gpt-4o-mini
```

### **ä¾èµ–åŒ…**

```bash
pip install -r requirements.txt
```

---

## ğŸš€ ä¸‹ä¸€æ­¥ä¼˜åŒ–

### **P0 (ç´§æ€¥)**

- [ ] æ·»åŠ é”™è¯¯é‡è¯•æœºåˆ¶
- [ ] ä¼˜åŒ–LLM Prompt
- [ ] æ·»åŠ æ—¥å¿—è®°å½•

### **P1 (é‡è¦)**

- [ ] çœŸå®æ™¯ç‚¹æ•°æ®å‘é‡åŒ–
- [ ] é›†æˆé«˜å¾·åœ°å›¾API
- [ ] çˆ¬å–ç¾é£Ÿå’Œé…’åº—æ•°æ®

### **P2 (å¯é€‰)**

- [ ] æ·»åŠ å¸‚å†…äº¤é€šè§„åˆ’
- [ ] æ”¯æŒå¤šåŸå¸‚è”æ¸¸
- [ ] ç”ŸæˆPDFè¡Œç¨‹å•

---

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### **Pythonä»£ç **

```python
from agent.core import AgentCore

# åˆå§‹åŒ–Agent
agent = AgentCore()
session_id = "user_123"

# ç”¨æˆ·è¾“å…¥
response = agent.process_message(
    session_id,
    "æˆ‘æƒ³ä»åŒ—äº¬å»æ­å·ç©3å¤©ï¼Œé¢„ç®—5000ï¼Œå–œæ¬¢æ–‡åŒ–å’Œç¾é£Ÿ"
)

# ç¡®è®¤
response = agent.process_message(session_id, "æ˜¯çš„ï¼Œæ­£ç¡®")

# è·å–è¡Œç¨‹
itinerary = response.get("itinerary")
print(itinerary)
```

### **APIè°ƒç”¨**

```bash
# å‘é€æ¶ˆæ¯
curl -X POST http://localhost:8000/api/chat \
  -H "Content-Type: application/json" \
  -d '{
    "session_id": "user_123",
    "message": "æˆ‘æƒ³ä»åŒ—äº¬å»æ­å·ç©3å¤©ï¼Œé¢„ç®—5000ï¼Œå–œæ¬¢æ–‡åŒ–å’Œç¾é£Ÿ"
  }'

# ç¡®è®¤
curl -X POST http://localhost:8000/api/chat \
  -H "Content-Type: application/json" \
  -d '{
    "session_id": "user_123",
    "message": "æ˜¯çš„ï¼Œæ­£ç¡®"
  }'
```

---

## âœ… æ€»ç»“

### **å®ç°å®Œæˆåº¦**: 100% âœ…

- âœ… Tool1: è·¨åŸäº¤é€šï¼ˆMockæ•°æ®ï¼‰
- âœ… Tool2: æ™¯ç‚¹æŸ¥è¯¢ï¼ˆMockæ•°æ®ï¼‰
- âœ… Tool3: ç¾é£Ÿæ¨èï¼ˆMockæ•°æ®ï¼‰
- âœ… Tool4: ä½å®¿æ¨èï¼ˆMockæ•°æ®ï¼‰
- âœ… LLMåˆ†æ­¥å†³ç­–ï¼ˆæ™¯ç‚¹é€‰æ‹© + è¡Œç¨‹è§„åˆ’ï¼‰
- âœ… Agent Coreé›†æˆ
- âœ… æµ‹è¯•è„šæœ¬

### **å¯è¿è¡Œ**: âœ…

æ‰€æœ‰ä»£ç å·²å®ç°ï¼Œå¯ç›´æ¥è¿è¡Œæµ‹è¯•ï¼š

```bash
cd /Applications/MyDocument/7103/backend
python test/test_step_by_step_agent.py
```

### **æ¨ç†æµç¨‹**: âœ…

å®Œå…¨æŒ‰ç…§ä½ çš„æ–¹æ¡ˆå®ç°ï¼š

1. âœ… ç”¨æˆ·è¾“å…¥åˆ†æ + éœ€æ±‚è¡¥å…¨
2. âœ… ç¡®è®¤ç”¨æˆ·éœ€æ±‚æ¨¡å‹
3. âœ… ç”Ÿæˆæ”»ç•¥
   - 3.1 âœ… Tool1: è·¨åŸäº¤é€š
   - 3.2 âœ… Tool2: æ™¯ç‚¹æŸ¥è¯¢
   - 3.3 âœ… Tool3: ç¾é£ŸæŸ¥è¯¢
   - 3.4 âœ… Tool4: ä½å®¿æŸ¥è¯¢
   - 3.5 âœ… LLMå†³ç­–: åˆ†æ­¥è§„åˆ’

---

**ğŸ‰ å®ç°å®Œæˆï¼å¯ä»¥å¼€å§‹æµ‹è¯•äº†ï¼**
