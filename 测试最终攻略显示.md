# æµ‹è¯•æœ€ç»ˆæ”»ç•¥æ˜¾ç¤º

## ğŸ” é—®é¢˜å®šä½

æ ¹æ®æ—¥å¿—ï¼Œåç«¯å·²ç»æˆåŠŸè¿”å›æ•°æ®ï¼ˆ200 OKï¼‰ï¼Œä½†å‰ç«¯å¡åœ¨"æ­£åœ¨æ€è€ƒ..."ã€‚

## ğŸ¯ å¯èƒ½çš„åŸå› 

### 1. å‰ç«¯loadingçŠ¶æ€æœªæ¸…é™¤

æ‰“å¼€æµè§ˆå™¨Consoleï¼Œè¾“å…¥ï¼š

```javascript
// æ£€æŸ¥loadingçŠ¶æ€
console.log('Loading:', window.$vm?.$store?.state?.loading)
```

### 2. æ¶ˆæ¯æœªæ­£ç¡®æ·»åŠ åˆ°messagesæ•°ç»„

åœ¨Consoleä¸­è¾“å…¥ï¼š

```javascript
// æ£€æŸ¥æœ€åä¸€æ¡æ¶ˆæ¯
const messages = window.$vm?.$store?.state?.messages
console.log('æœ€åä¸€æ¡æ¶ˆæ¯:', messages[messages.length - 1])
console.log('æ˜¯å¦æœ‰itinerary:', messages[messages.length - 1]?.itinerary)
```

### 3. Vueå“åº”å¼æœªè§¦å‘

å¯èƒ½æ˜¯å› ä¸ºæ•°æ®æ›´æ–°äº†ä½†Vueæ²¡æœ‰æ£€æµ‹åˆ°å˜åŒ–ã€‚

## ğŸ› ï¸ ä¸´æ—¶è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: æ‰‹åŠ¨åˆ·æ–°é¡µé¢

é€‰æ‹©ä½å®¿åï¼Œå¦‚æœå¡ä½äº†ï¼š
1. æŒ‰ `F5` åˆ·æ–°é¡µé¢
2. é‡æ–°å¼€å§‹å¯¹è¯

### æ–¹æ¡ˆ2: ä½¿ç”¨æµè§ˆå™¨Consoleæ‰‹åŠ¨è§¦å‘

1. æ‰“å¼€Console (F12)
2. è¾“å…¥ä»¥ä¸‹ä»£ç æ¨¡æ‹Ÿæ·»åŠ æ¶ˆæ¯ï¼š

```javascript
// è·å–store
const chatStore = window.$pinia?.state?.value?.chat

if (chatStore) {
  // æ‰‹åŠ¨æ·»åŠ æœ€ç»ˆæ”»ç•¥æ¶ˆæ¯
  chatStore.messages.push({
    role: 'assistant',
    content: 'âœ… å¤ªå¥½äº†ï¼æ‚¨çš„ä¸“å±æ—…è¡Œæ”»ç•¥å·²ç”Ÿæˆå®Œæ¯•ã€‚ç¥æ‚¨æ—…é€”æ„‰å¿«ï¼',
    timestamp: new Date().toISOString(),
    itinerary: {
      destination: 'æ­å·',
      duration_days: 3,
      total_budget: 5000,
      transport: {
        outbound: { method: 'é«˜é“', cost: 300 },
        return: { method: 'é«˜é“', cost: 300 }
      },
      daily_plans: [
        {
          day: 1,
          theme: 'ç¬¬1å¤©',
          schedule: [
            { type: 'æ™¯ç‚¹', name: 'è¥¿æ¹–', cost: 0 },
            { type: 'åˆé¤', name: 'å¤–å©†å®¶(æ¹–æ»¨åº—)', cost: 80 },
            { type: 'åˆé¤', name: 'æ¥¼å¤–æ¥¼(å­¤å±±åº—)', cost: 150 }
          ]
        },
        {
          day: 2,
          theme: 'ç¬¬2å¤©',
          schedule: [
            { type: 'æ™¯ç‚¹', name: 'çµéšå¯º', cost: 30 },
            { type: 'åˆé¤', name: 'çŸ¥å‘³è§‚(æ¹–æ»¨åº—)', cost: 60 },
            { type: 'åˆé¤', name: 'çµéšå¯ºç´ æ–‹', cost: 100 }
          ]
        },
        {
          day: 3,
          theme: 'ç¬¬3å¤©',
          schedule: [
            { type: 'æ™¯ç‚¹', name: 'èŒ…å®¶åŸ ', cost: 0 },
            { type: 'åˆé¤', name: 'é¾™äº•èŒ¶å®¤', cost: 80 },
            { type: 'åˆé¤', name: 'å±±å¤–å±±', cost: 120 }
          ]
        }
      ],
      budget_breakdown: {
        transport: 600,
        attractions: 30,
        food: 590,
        accommodation: 2400,
        misc: 500,
        total: 4120
      }
    }
  })
  
  // æ¸…é™¤loading
  chatStore.loading = false
  
  console.log('âœ… å·²æ‰‹åŠ¨æ·»åŠ æœ€ç»ˆæ”»ç•¥')
}
```

## ğŸ› è°ƒè¯•æ­¥éª¤

### æ­¥éª¤1: æ·»åŠ Consoleæ—¥å¿—

ä¿®æ”¹ `frontend/src/stores/chat.js`ï¼Œåœ¨`sendMessage`å‡½æ•°ä¸­æ·»åŠ æ—¥å¿—ï¼š

```javascript
async function sendMessage(content, selection = null) {
  loading.value = true
  console.log('ğŸš€ [Store] å‘é€æ¶ˆæ¯å¼€å§‹')
  console.log('ğŸ“ [Store] å†…å®¹:', content)
  console.log('ğŸ“¦ [Store] é€‰æ‹©:', selection)
  
  // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
  addMessage({
    role: 'user',
    content
  })
  console.log('âœ… [Store] ç”¨æˆ·æ¶ˆæ¯å·²æ·»åŠ ')

  try {
    const requestData = {
      session_id: sessionId.value,
      message: content
    }
    
    if (selection) {
      requestData.selection = selection
    }
    
    console.log('ğŸ“¤ [Store] å‘é€è¯·æ±‚:', requestData)
    const response = await sendMessageAPI(requestData)
    console.log('ğŸ“¥ [Store] æ”¶åˆ°å“åº”:', response)
    console.log('ğŸ“Š [Store] å“åº”æ•°æ®:', response.data)

    // æ·»åŠ Agentå›å¤
    if (response.data) {
      const assistantMessage = {
        role: 'assistant',
        content: response.data.reply,
        itinerary: response.data.itinerary,
        recommendation: response.data.recommendation
      }
      
      console.log('ğŸ’¬ [Store] å‡†å¤‡æ·»åŠ åŠ©æ‰‹æ¶ˆæ¯:', assistantMessage)
      console.log('ğŸ—ºï¸ [Store] æ˜¯å¦æœ‰itinerary:', !!response.data.itinerary)
      console.log('ğŸ’¡ [Store] æ˜¯å¦æœ‰recommendation:', !!response.data.recommendation)
      
      addMessage(assistantMessage)
      console.log('âœ… [Store] åŠ©æ‰‹æ¶ˆæ¯å·²æ·»åŠ ')
      console.log('ğŸ“‹ [Store] å½“å‰æ¶ˆæ¯æ•°:', messages.value.length)

      // æ›´æ–°çŠ¶æ€
      if (response.data.stage) {
        currentStage.value = response.data.stage
        console.log('ğŸ¯ [Store] é˜¶æ®µæ›´æ–°ä¸º:', response.data.stage)
      }
      if (response.data.requirements) {
        currentRequirements.value = response.data.requirements
      }
      if (response.data.itinerary) {
        currentItinerary.value = response.data.itinerary
        console.log('ğŸ‰ [Store] è¡Œç¨‹å·²ä¿å­˜åˆ°store')
      }
    }

    return response
  } catch (error) {
    console.error('âŒ [Store] å‘é€æ¶ˆæ¯å¤±è´¥:', error)
    throw error
  } finally {
    loading.value = false
    console.log('ğŸ [Store] Loadingå·²æ¸…é™¤')
  }
}
```

### æ­¥éª¤2: æ£€æŸ¥ChatViewç»„ä»¶

åœ¨ `frontend/src/views/ChatView.vue` çš„ `handleSelection` æ–¹æ³•ä¸­æ·»åŠ æ—¥å¿—ï¼š

```javascript
async function handleSelection(selectionData) {
  console.log('ğŸ¯ [ChatView] æ”¶åˆ°é€‰æ‹©:', selectionData)
  
  try {
    console.log('ğŸ“¤ [ChatView] è°ƒç”¨store.sendMessage')
    await chatStore.sendMessage(selectionData.message, selectionData.choice)
    console.log('âœ… [ChatView] sendMessageå®Œæˆ')
    
    scrollToBottom()
    console.log('ğŸ“œ [ChatView] å·²æ»šåŠ¨åˆ°åº•éƒ¨')
  } catch (error) {
    console.error('âŒ [ChatView] å‘é€é€‰æ‹©å¤±è´¥:', error)
    ElMessage.error('å‘é€é€‰æ‹©å¤±è´¥ï¼Œè¯·é‡è¯•')
  }
}
```

### æ­¥éª¤3: æµ‹è¯•å®Œæ•´æµç¨‹

1. æ‰“å¼€æµè§ˆå™¨Console
2. åˆ·æ–°é¡µé¢ (F5)
3. å¼€å§‹æ–°çš„å¯¹è¯
4. è§‚å¯ŸConsoleè¾“å‡º
5. å½“é€‰æ‹©ä½å®¿åï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰ä»¥ä¸‹æ—¥å¿—ï¼š

```
ğŸš€ [Store] å‘é€æ¶ˆæ¯å¼€å§‹
ğŸ“ [Store] å†…å®¹: æˆ‘é€‰æ‹©æ­å·è¥¿å­æ¹–å››å­£é…’åº—
ğŸ“¦ [Store] é€‰æ‹©: {id: "hz_hotel_001", name: "æ­å·è¥¿å­æ¹–å››å­£é…’åº—", ...}
âœ… [Store] ç”¨æˆ·æ¶ˆæ¯å·²æ·»åŠ 
ğŸ“¤ [Store] å‘é€è¯·æ±‚: {...}
ğŸ“¥ [Store] æ”¶åˆ°å“åº”: {...}
ğŸ“Š [Store] å“åº”æ•°æ®: {reply: "...", stage: "completed", itinerary: {...}}
ğŸ’¬ [Store] å‡†å¤‡æ·»åŠ åŠ©æ‰‹æ¶ˆæ¯: {...}
ğŸ—ºï¸ [Store] æ˜¯å¦æœ‰itinerary: true
ğŸ’¡ [Store] æ˜¯å¦æœ‰recommendation: false
âœ… [Store] åŠ©æ‰‹æ¶ˆæ¯å·²æ·»åŠ 
ğŸ“‹ [Store] å½“å‰æ¶ˆæ¯æ•°: 12
ğŸ¯ [Store] é˜¶æ®µæ›´æ–°ä¸º: completed
ğŸ‰ [Store] è¡Œç¨‹å·²ä¿å­˜åˆ°store
ğŸ [Store] Loadingå·²æ¸…é™¤
```

## ğŸ“ é¢„æœŸç»“æœ

å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
1. Loadingå›¾æ ‡æ¶ˆå¤±
2. æ˜¾ç¤º"âœ… å¤ªå¥½äº†ï¼æ‚¨çš„ä¸“å±æ—…è¡Œæ”»ç•¥å·²ç”Ÿæˆå®Œæ¯•ã€‚ç¥æ‚¨æ—…é€”æ„‰å¿«ï¼"
3. ä¸‹æ–¹å±•ç¤ºå®Œæ•´çš„è¡Œç¨‹å¡ç‰‡

## ğŸš¨ å¦‚æœä»ç„¶å¡ä½

### æ£€æŸ¥ç‚¹1: ç½‘ç»œè¯·æ±‚æ˜¯å¦å®Œæˆ

Networkæ ‡ç­¾ â†’ æ‰¾åˆ°æœ€åä¸€ä¸ª `/api/chat` è¯·æ±‚ â†’ æ£€æŸ¥Statusæ˜¯å¦ä¸º200

### æ£€æŸ¥ç‚¹2: å“åº”æ•°æ®æ˜¯å¦æ­£ç¡®

Networkæ ‡ç­¾ â†’ Responseæ ‡ç­¾ â†’ ç¡®è®¤æœ‰`itinerary`å­—æ®µ

### æ£€æŸ¥ç‚¹3: Vueç»„ä»¶æ˜¯å¦æ¸²æŸ“

Elementsæ ‡ç­¾ â†’ æœç´¢ `itinerary-card` â†’ ç¡®è®¤DOMå…ƒç´ æ˜¯å¦å­˜åœ¨

### æ£€æŸ¥ç‚¹4: CSSæ˜¯å¦éšè—äº†å…ƒç´ 

Elementsæ ‡ç­¾ â†’ é€‰ä¸­ `itinerary-card` â†’ æ£€æŸ¥Computedæ ·å¼ â†’ ç¡®è®¤`display`ä¸æ˜¯`none`

---

**æ›´æ–°æ—¶é—´**: 2025-11-19  
**ç‰ˆæœ¬**: v1.0

