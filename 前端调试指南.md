# å‰ç«¯è°ƒè¯•æŒ‡å—

## é—®é¢˜ï¼šé€‰æ‹©ä½å®¿åï¼Œé¡µé¢å¡åœ¨"æ­£åœ¨æ€è€ƒ..."

### ç—‡çŠ¶
- åç«¯æ—¥å¿—æ˜¾ç¤ºè¿”å›äº†200 OK
- åç«¯è¿”å›äº†å®Œæ•´çš„itineraryæ•°æ®
- å‰ç«¯é¡µé¢æ˜¾ç¤º"æ­£åœ¨æ€è€ƒ..."ä¸æ¶ˆå¤±
- æœ€ç»ˆæ”»ç•¥æ²¡æœ‰å±•ç¤º

### è°ƒè¯•æ­¥éª¤

#### 1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·

æŒ‰ `F12` æˆ– `Cmd+Option+I` (Mac)

#### 2. æ£€æŸ¥Networkæ ‡ç­¾

1. åˆ‡æ¢åˆ° **Network** æ ‡ç­¾
2. æ‰¾åˆ°æœ€åä¸€ä¸ª `/api/chat` è¯·æ±‚
3. ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…
4. æ£€æŸ¥ **Response** æ ‡ç­¾ï¼Œç¡®è®¤è¿”å›çš„æ•°æ®ç»“æ„

**é¢„æœŸå“åº”**:
```json
{
  "reply": "âœ… å¤ªå¥½äº†ï¼æ‚¨çš„ä¸“å±æ—…è¡Œæ”»ç•¥å·²ç”Ÿæˆå®Œæ¯•ã€‚ç¥æ‚¨æ—…é€”æ„‰å¿«ï¼",
  "stage": "completed",
  "requirements": {...},
  "selections": {...},
  "itinerary": {
    "destination": "æ­å·",
    "duration_days": 3,
    "total_budget": 5000,
    "daily_plans": [
      {
        "day": 1,
        "schedule": [...]
      }
    ],
    "budget_breakdown": {...}
  }
}
```

#### 3. æ£€æŸ¥Consoleæ ‡ç­¾

åˆ‡æ¢åˆ° **Console** æ ‡ç­¾ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯ï¼š

**å¸¸è§é”™è¯¯**:
- `TypeError: Cannot read property 'xxx' of undefined`
- `ReferenceError: xxx is not defined`
- Vueè­¦å‘Šä¿¡æ¯

#### 4. æ£€æŸ¥Vue Devtools

å¦‚æœå®‰è£…äº†Vue Devtoolsï¼š

1. åˆ‡æ¢åˆ° **Vue** æ ‡ç­¾
2. é€‰æ‹© `ChatView` ç»„ä»¶
3. æŸ¥çœ‹ `messages` æ•°ç»„
4. ç¡®è®¤æœ€åä¸€æ¡æ¶ˆæ¯æ˜¯å¦åŒ…å« `itinerary` å­—æ®µ

#### 5. æ‰‹åŠ¨æµ‹è¯•API

ä½¿ç”¨curlæµ‹è¯•APIï¼š

```bash
# 1. åˆ›å»ºä¼šè¯å¹¶å‘é€æ¶ˆæ¯
curl -X POST http://localhost:8000/api/chat \
  -H "Content-Type: application/json" \
  -d '{
    "session_id": "test_manual",
    "message": "æˆ‘æƒ³å»æ­å·ç©3å¤©ï¼Œé¢„ç®—5000å…ƒï¼Œå–œæ¬¢ç¾é£Ÿ"
  }'

# 2. ç¡®è®¤éœ€æ±‚
curl -X POST http://localhost:8000/api/chat \
  -H "Content-Type: application/json" \
  -d '{
    "session_id": "test_manual",
    "message": "æ˜¯çš„"
  }'

# 3. é€‰æ‹©äº¤é€š
curl -X POST http://localhost:8000/api/chat \
  -H "Content-Type: application/json" \
  -d '{
    "session_id": "test_manual",
    "message": "æˆ‘é€‰æ‹©é«˜é“",
    "selection": {"choice": {"method": "é«˜é“", "cost": 300}}
  }'

# 4. ç¡®è®¤æ™¯ç‚¹
curl -X POST http://localhost:8000/api/chat \
  -H "Content-Type: application/json" \
  -d '{
    "session_id": "test_manual",
    "message": "ç¡®è®¤æ™¯ç‚¹å®‰æ’"
  }'

# 5. ç¡®è®¤ç¾é£Ÿ
curl -X POST http://localhost:8000/api/chat \
  -H "Content-Type: application/json" \
  -d '{
    "session_id": "test_manual",
    "message": "ç¡®è®¤ç¾é£Ÿå®‰æ’"
  }'

# 6. é€‰æ‹©ä½å®¿ï¼ˆåº”è¯¥è¿”å›itineraryï¼‰
curl -X POST http://localhost:8000/api/chat \
  -H "Content-Type: application/json" \
  -d '{
    "session_id": "test_manual",
    "message": "æˆ‘é€‰æ‹©æ­å·è¥¿å­æ¹–å››å­£é…’åº—",
    "selection": {
      "choice": {
        "id": "hz_hotel_001",
        "name": "æ­å·è¥¿å­æ¹–å››å­£é…’åº—",
        "price_per_night": 800,
        "nights": 3,
        "total_cost": 2400
      }
    }
  }' | jq .
```

### å¯èƒ½çš„åŸå› å’Œè§£å†³æ–¹æ¡ˆ

#### åŸå› 1: å‰ç«¯loadingçŠ¶æ€æœªæ¸…é™¤

**æ£€æŸ¥**: `frontend/src/stores/chat.js`

```javascript
async function sendMessage(content, selection = null) {
  loading.value = true  // è®¾ç½®loading
  
  try {
    // ... å‘é€è¯·æ±‚
    const response = await sendMessageAPI(requestData)
    
    // ... å¤„ç†å“åº”
    
  } catch (error) {
    console.error('å‘é€æ¶ˆæ¯å¤±è´¥:', error)
    throw error
  } finally {
    loading.value = false  // âš ï¸ å¿…é¡»æ¸…é™¤loading
  }
}
```

**è§£å†³**: ç¡®ä¿`finally`å—ä¸­æœ‰`loading.value = false`

#### åŸå› 2: å“åº”æ•°æ®æ ¼å¼ä¸åŒ¹é…

**æ£€æŸ¥**: å‰ç«¯æœŸæœ›çš„æ•°æ®ç»“æ„ä¸åç«¯è¿”å›çš„æ˜¯å¦ä¸€è‡´

**åç«¯è¿”å›**:
```json
{
  "itinerary": {
    "daily_plans": [
      {
        "schedule": [...]  // âœ… æ­£ç¡®
      }
    ]
  }
}
```

**å‰ç«¯æœŸæœ›**:
```vue
<div v-if="message.itinerary">
  <div v-for="plan in message.itinerary.daily_plans">
    <div v-for="activity in plan.schedule">
      {{ activity.name }}
    </div>
  </div>
</div>
```

#### åŸå› 3: Vueå“åº”å¼é—®é¢˜

**ç—‡çŠ¶**: æ•°æ®å·²æ›´æ–°ä½†UIæœªåˆ·æ–°

**è§£å†³**:
```javascript
// æ–¹æ³•1: ä½¿ç”¨Vue.set (Vue 2)
Vue.set(messages, index, newMessage)

// æ–¹æ³•2: ä½¿ç”¨ref (Vue 3)
messages.value.push(newMessage)

// æ–¹æ³•3: å¼ºåˆ¶æ›´æ–°
nextTick(() => {
  // UIå·²æ›´æ–°
})
```

#### åŸå› 4: APIé”™è¯¯ä½†æœªæ•è·

**æ£€æŸ¥**: Networkæ ‡ç­¾ä¸­çš„Status Code

- âœ… 200 OK - æˆåŠŸ
- âŒ 500 Internal Server Error - æœåŠ¡å™¨é”™è¯¯
- âŒ 400 Bad Request - è¯·æ±‚æ ¼å¼é”™è¯¯

### å¿«é€Ÿä¿®å¤

#### æ–¹æ³•1: æ¸…é™¤æµè§ˆå™¨ç¼“å­˜

1. æŒ‰ `Cmd+Shift+R` (Mac) æˆ– `Ctrl+Shift+R` (Windows)
2. å¼ºåˆ¶åˆ·æ–°é¡µé¢

#### æ–¹æ³•2: é‡å¯å‰ç«¯å¼€å‘æœåŠ¡å™¨

```bash
cd /Applications/MyDocument/7103/frontend
# Ctrl+C åœæ­¢å½“å‰æœåŠ¡
npm run dev
```

#### æ–¹æ³•3: æ·»åŠ è°ƒè¯•æ—¥å¿—

åœ¨ `frontend/src/stores/chat.js` ä¸­æ·»åŠ ï¼š

```javascript
async function sendMessage(content, selection = null) {
  loading.value = true
  console.log('ğŸ“¤ å‘é€æ¶ˆæ¯:', content, selection)
  
  try {
    const response = await sendMessageAPI(requestData)
    console.log('ğŸ“¥ æ”¶åˆ°å“åº”:', response.data)
    
    if (response.data) {
      console.log('âœ… æ·»åŠ æ¶ˆæ¯:', {
        role: 'assistant',
        content: response.data.reply,
        itinerary: response.data.itinerary,
        recommendation: response.data.recommendation
      })
      
      addMessage({
        role: 'assistant',
        content: response.data.reply,
        itinerary: response.data.itinerary,
        recommendation: response.data.recommendation
      })
    }
    
  } catch (error) {
    console.error('âŒ å‘é€å¤±è´¥:', error)
    throw error
  } finally {
    console.log('ğŸ”„ æ¸…é™¤loading')
    loading.value = false
  }
}
```

#### æ–¹æ³•4: æ£€æŸ¥AccommodationSelectorç»„ä»¶

ç¡®è®¤é€‰æ‹©å™¨æ­£ç¡®å‘é€æ•°æ®ï¼š

```vue
<!-- AccommodationSelector.vue -->
<script setup>
const confirmSelection = () => {
  if (selectedOption.value) {
    console.log('ğŸ¨ å‘é€ä½å®¿é€‰æ‹©:', selectedOption.value)
    
    emit('select', {
      type: 'accommodation',
      choice: {
        id: selectedOption.value.id,
        name: selectedOption.value.name,
        price_per_night: selectedOption.value.price_per_night,
        nights: selectedOption.value.nights,
        total_cost: selectedOption.value.total_cost,
        // ... å…¶ä»–å­—æ®µ
      },
      message: `æˆ‘é€‰æ‹©${selectedOption.value.name}`
    })
  }
}
</script>
```

### éªŒè¯ä¿®å¤

1. æ‰“å¼€æµè§ˆå™¨Console
2. å®Œæˆæ•´ä¸ªæµç¨‹
3. æŸ¥çœ‹Consoleè¾“å‡ºï¼š

```
ğŸ“¤ å‘é€æ¶ˆæ¯: æˆ‘é€‰æ‹©æ­å·è¥¿å­æ¹–å››å­£é…’åº— {...}
ğŸ“¥ æ”¶åˆ°å“åº”: {reply: "...", stage: "completed", itinerary: {...}}
âœ… æ·»åŠ æ¶ˆæ¯: {role: "assistant", content: "...", itinerary: {...}}
ğŸ”„ æ¸…é™¤loading
```

4. ç¡®è®¤é¡µé¢æ˜¾ç¤ºæœ€ç»ˆæ”»ç•¥

---

## è”ç³»æ”¯æŒ

å¦‚æœä»¥ä¸Šæ–¹æ³•éƒ½æ— æ³•è§£å†³é—®é¢˜ï¼Œè¯·æä¾›ï¼š

1. æµè§ˆå™¨Consoleçš„å®Œæ•´é”™è¯¯ä¿¡æ¯
2. Networkæ ‡ç­¾ä¸­æœ€åä¸€ä¸ªè¯·æ±‚çš„Response
3. Vue Devtoolsä¸­messagesæ•°ç»„çš„å†…å®¹
4. æµè§ˆå™¨ç‰ˆæœ¬å’Œæ“ä½œç³»ç»Ÿ

---

**æ›´æ–°æ—¶é—´**: 2025-11-19  
**ç‰ˆæœ¬**: v1.0

