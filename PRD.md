# 产品需求文档 (PRD)

## TravelMate AI - 个性化旅游攻略生成Agent

---

## 📋 项目概述

### 1.1 项目背景

随着旅游需求的个性化发展，传统的旅游攻略网站提供的信息过于泛化，用户需要花费大量时间筛选和规划。本项目旨在通过AI Agent技术，提供智能化、个性化的旅游攻略生成服务。

### 1.2 项目目标

- 开发一个基于LLM的对话式旅游规划Agent
- 支持广东省、江苏省、浙江省三个目的地的行程规划
- 通过多轮对话挖掘用户需求，自动生成个性化行程
- 整合实时信息（天气、景点、交通）提供可行建议

### 1.3 项目范围

**包含功能：**

- ✅ 多轮对话式需求收集
- ✅ 智能行程规划（3-7天）
- ✅ **RAG知识库系统**（景点百科、旅游攻略检索）
- ✅ 天气信息查询
- ✅ 景点推荐与介绍
- ✅ 交通路线建议
- ✅ 预算估算
- ✅ 行程输出（Markdown/PDF格式）
- ✅ **传统Web界面**（前后端分离）

**不包含功能（V1版本）：**

- ❌ 在线支付/预订
- ❌ 实时动态调整
- ❌ AR导航
- ❌ 多人协同规划

---

## 🎯 核心功能需求

### 2.1 对话管理系统

#### 2.1.1 功能描述

通过自然语言对话，逐步收集用户旅行需求，包括：

- 目的地选择（广东/江苏/浙江及具体城市）
- 出行时间和天数（3-7天）
- 旅行预算范围
- 旅行偏好（美食、文化、自然、休闲等）
- 出行人员（独行/情侣/家庭/朋友）
- 特殊需求（无障碍、亲子设施等）

#### 2.1.2 交互流程

```
1. 欢迎语 + 引导用户输入基本需求
2. 识别关键信息（目的地、时间、预算）
3. 追问补充信息（偏好、人员类型）
4. 确认需求总结
5. 生成行程
6. 支持修改调整（2轮以内）
```

#### 2.1.3 输入示例

```
用户："我想去杭州玩3天"
Agent："好的！为了给您制定更合适的行程，我需要了解：
      1. 您计划什么时候去？（具体日期或季节）
      2. 大概的预算范围是多少？
      3. 您对哪些方面比较感兴趣？（美食/文化/自然风光/休闲等）"
```

#### 2.1.4 技术要求

- 使用LLM进行意图识别和实体抽取
- 维护对话上下文（最近5轮）
- 需求完整度检查（必填项：目的地、天数、预算、偏好）

---

### 2.2 RAG知识库系统

#### 2.2.0 功能描述

基于检索增强生成(RAG)技术，构建旅游知识库，提供：

- **景点百科知识**：详细的景点历史、文化背景、最佳游览攻略
- **旅游经验库**：真实用户的旅游心得、踩坑经验
- **本地化信息**：交通tips、美食推荐、住宿建议
- **季节性攻略**：不同季节的特色活动和注意事项

#### 2.2.0.1 RAG技术实现

**知识库构建：**

```
1. 数据收集
   - 爬取携程/马蜂窝等平台的攻略文章
   - 收集景点官方介绍
   - 整理用户评论和游记
   
2. 文档处理
   - 文本分块（chunk size: 500 tokens）
   - 去除噪音和广告内容
   - 标准化格式
   
3. 向量化
   - 使用text-embedding-3-small模型
   - 存储到ChromaDB向量数据库
   - 建立索引（按城市/类别分类）
   
4. 检索策略
   - 语义检索（相似度>0.7）
   - 混合检索（语义+关键词）
   - 重排序（Rerank）优化
```

**应用场景：**

```
场景1：用户问"西湖什么季节去最好？"
→ RAG检索相关攻略文档
→ LLM整合信息回答："春秋两季最佳，春季可赏樱花..."

场景2：生成行程时
→ 检索景点深度攻略
→ 补充游览tips和注意事项
→ 提供更专业的建议

场景3：美食推荐
→ 检索当地美食评价
→ 推荐高评分餐厅
→ 提供避坑指南
```

#### 2.2.0.2 知识库内容结构

```json
{
    "doc_id": "hz_xihu_001",
    "type": "attraction_guide",
    "city": "杭州",
    "attraction": "西湖",
    "title": "西湖最佳游览路线攻略",
    "content": "西湖作为杭州的标志性景点...",
    "tags": ["路线推荐", "春季", "拍照"],
    "source": "马蜂窝",
    "rating": 4.8,
    "useful_count": 1520,
    "publish_date": "2024-03"
}
```

---

### 2.3 工具链系统

#### 2.3.1 天气查询工具

**功能：** 查询目的地未来7天天气预报

**API选择：**

- 免费方案：和风天气API（免费版1000次/天）
- 备选：OpenWeatherMap API

**输入：** 城市名称、日期范围
**输出：** 温度、天气状况、降水概率、穿衣建议

```python
# 示例输出
{
    "city": "杭州",
    "date": "2025-11-20",
    "weather": "多云",
    "temp_high": 18,
    "temp_low": 12,
    "rain_prob": 20,
    "advice": "适合户外活动，建议穿薄外套"
}
```

#### 2.3.2 景点信息库

**数据来源：**

- 预构建景点数据库（JSON格式）
- 包含三省主要城市TOP 50景点

**景点信息字段：**

```json
{
    "name": "西湖",
    "city": "杭州",
    "province": "浙江省",
    "category": ["自然风光", "文化"],
    "rating": 4.8,
    "visit_duration": 3,  // 小时
    "ticket_price": 0,
    "opening_hours": "全天",
    "best_season": ["春季", "秋季"],
    "description": "...",
    "location": {"lat": 30.2591, "lng": 120.1353},
    "tags": ["必游", "免费", "适合拍照"]
}
```

**查询功能：**

- 按城市筛选
- 按类别筛选（美食、文化、自然等）
- 按评分排序
- 相似景点推荐（基于向量相似度）

#### 2.3.3 路线规划工具

**功能：** 计算景点间距离和交通方式

**实现方式：**

- 简化版：使用经纬度计算直线距离，设定阈值
  - < 2km：步行
  - 2-10km：地铁/公交
  - > 10km：出租车/包车
    >

**输出：**

```python
{
    "from": "西湖",
    "to": "灵隐寺",
    "distance": 8.5,  // km
    "method": "公交/地铁",
    "estimated_time": 40,  // 分钟
    "estimated_cost": 5  // 元
}
```

#### 2.3.4 预算计算工具

**功能：** 根据行程估算总花费

**计费标准：**

```
交通费：
  - 市内交通：30元/天
  - 高铁（省内城市间）：100-300元/程
  
住宿费：
  - 经济型：150-250元/晚
  - 舒适型：300-500元/晚
  - 高档型：600+元/晚

餐饮费：
  - 经济：80元/天
  - 标准：150元/天
  - 品质：250元/天

门票费：按景点实际价格累加
```

---

### 2.4 行程生成器

#### 2.4.1 规划算法

**输入：**

- 用户需求（城市、天数、偏好、预算）
- 天气信息
- 景点数据

**处理流程：**

```
1. 景点筛选
   - 根据城市和偏好类别筛选候选景点（TOP 20）
   - 根据天气排除不适合的景点（雨天排除户外）

2. 景点评分排序
   - 基础分：景点评分 * 0.4
   - 匹配度：与偏好匹配 * 0.3
   - 热度：标签"必游" * 0.2
   - 季节适配：当前季节是否为最佳 * 0.1

3. 行程分配
   - 每天4-5个景点（包含餐饮）
   - 按地理位置聚类，同区域景点安排在同一天
   - 考虑开放时间、推荐游览时长

4. 时间规划
   - 上午：9:00-12:00（2-3小时景点）
   - 午餐：12:00-13:30
   - 下午：13:30-17:30（2-3小时景点）
   - 晚餐：18:00-19:30
   - 晚间：可选夜游景点

5. 预算校验
   - 计算总费用，超预算则调整住宿档次或减少景点
```

#### 2.4.2 输出格式

```markdown
# 杭州3日深度游攻略

## 📊 行程概览
- 🗓️ 出行日期：2025-11-20 ~ 2025-11-22
- 💰 预算范围：2000-2500元
- 🎯 旅行主题：文化 + 美食
- 👤 出行人数：2人

## ☀️ 天气预报
- 11月20日：多云，12-18℃，适合游览
- 11月21日：晴，10-16℃，适合游览  
- 11月22日：小雨，13-17℃，建议室内活动

---

## 📅 Day 1：西湖文化之旅 (11月20日)

### 上午 9:00-12:00
**📍 西湖景区**
- ⏰ 游览时间：3小时
- 🎫 门票：免费
- 📝 推荐路线：断桥残雪 → 白堤 → 平湖秋月
- 💡 小贴士：早起可欣赏湖面晨雾

### 中午 12:00-13:30
**🍜 午餐推荐：外婆家（湖滨店）**
- 💰 人均：60元
- 🌟 推荐菜：西湖醋鱼、龙井虾仁

### 下午 13:30-17:00
**📍 灵隐寺**
- 🚌 交通：从西湖乘公交约40分钟
- 🎫 门票：75元
- ⏰ 游览时间：2.5小时

### 晚上 18:00-21:00
**📍 河坊街 + 晚餐**
- 💰 预算：80元
- 🎯 体验：古街夜景 + 小吃

**💰 今日花费：**
- 交通：15元
- 餐饮：140元
- 门票：75元
- 住宿：300元
- **小计：530元**

---

## 💰 费用明细
| 类别 | 费用 |
|------|------|
| 交通 | 300元 |
| 住宿 | 600元 |
| 餐饮 | 420元 |
| 门票 | 350元 |
| 其他 | 130元 |
| **总计** | **1800元** |

## 📌 贴心提示
1. 🏨 住宿建议选择西湖周边，交通便利
2. 🚇 购买杭州地铁日卡更划算
3. 📱 提前下载"杭州通"APP
4. ☔ 11月22日有雨，建议准备雨具
```

---

## 🎨 用户界面

### 3.1 界面设计（前后端分离架构）

#### 3.1.1 技术栈选择

**前端：**

- HTML5 + CSS3 + JavaScript
- 框架：Vue.js 3 或 React 18（推荐Vue.js，学习曲线平缓）
- UI组件库：Element Plus / Ant Design Vue
- HTTP客户端：Axios
- 状态管理：Pinia (Vue) / Redux (React)

**后端：**

- FastAPI（Python 3.9+）
- WebSocket支持（实时对话）
- CORS中间件（跨域支持）
- Uvicorn服务器

#### 3.1.2 页面布局设计

**主页面布局：**

```
┌─────────────────────────────────────────────────────────┐
│  🌍 TravelMate AI - 智能旅游规划助手    [登录] [关于]     │
├─────────────────┬───────────────────────────────────────┤
│                 │                                       │
│  侧边栏          │        对话区域                        │
│                 │                                       │
│  📋 当前状态     │  🤖 Agent: 您好！我是您的旅行...       │
│  ━━━━━━━━━      │                                       │
│  📍 目的地: -    │  👤 User: 我想去杭州玩3天             │
│  📅 天数: -      │                                       │
│  💰 预算: -      │  🤖 Agent: 好的！为了给您...          │
│  🎯 偏好: -      │                                       │
│                 │  ...                                  │
│  快速开始 📌     │                                       │
│  • 3天杭州游    │                                       │
│  • 5天苏州游    │  ─────────────────────────────────    │
│  • 周末广州游   │  [输入框]  📎 [发送]  🔄 [重置]        │
│                 │                                       │
└─────────────────┴───────────────────────────────────────┘
```

#### 3.1.3 核心页面

**1. 首页/对话页面 (index.html)**

- 对话区域（支持滚动、消息气泡样式）
- 实时输入提示
- 加载动画
- 需求信息卡片

**2. 行程展示页面 (itinerary.html)**

- 行程时间轴展示
- 地图可视化（高德地图API）
- 景点卡片（图片、介绍、门票）
- 费用统计图表
- 导出功能（PDF/图片）

**3. 历史记录页面 (history.html)**

- 历史对话列表
- 已生成行程列表
- 收藏夹功能

### 3.2 交互功能

#### 3.2.1 实时对话

- **WebSocket连接**：实时双向通信
- **打字机效果**：流式显示Agent回复
- **消息状态**：发送中/已送达/失败
- **快捷操作**：复制消息、重新发送

#### 3.2.2 行程交互

- **可视化展示**：

  - 日程时间轴
  - 地图路线标注
  - 天气图标动画
- **交互操作**：

  - 拖拽调整景点顺序
  - 点击景点查看详情
  - 景点替换（从推荐列表选择）
- **导出功能**：

  - 生成精美PDF
  - 生成分享卡片（图片）
  - 复制Markdown文本

#### 3.2.3 响应式设计

- **桌面端**（>1024px）：侧边栏 + 主内容区
- **平板端**（768-1024px）：可折叠侧边栏
- **移动端**（<768px）：全屏对话，底部导航

---

## 🏗️ 技术架构

### 4.1 系统架构图

```
┌─────────────────────────────────────────┐
│         Streamlit Web界面                │
└──────────────┬──────────────────────────┘
               │
┌──────────────▼──────────────────────────┐
│         Agent核心 (AgentCore)            │
│  - DialogueManager (对话管理)            │
│  - StateTracker (状态跟踪)               │
│  - ToolOrchestrator (工具编排)           │
└──────────────┬──────────────────────────┘
               │
    ┌──────────┼──────────┐
    ▼          ▼          ▼
┌────────┐ ┌────────┐ ┌──────────┐
│ LLM    │ │ Tools  │ │ Database │
│ (GPT)  │ │        │ │          │
└────────┘ └────┬───┘ └──────────┘
                │
        ┌───────┼───────┐
        ▼       ▼       ▼
    ┌──────┐┌──────┐┌──────┐
    │天气API││景点库││路线  │
    └──────┘└──────┘└──────┘
```

### 4.2 技术栈

**核心技术：**

- **后端：** Python 3.9+
- **LLM：** OpenAI GPT-4o-mini（成本控制）或兼容API
- **前端：** Streamlit 1.28+
- **数据库：** JSON文件 + SQLite（可选）
- **向量检索：** FAISS（景点相似度）

**依赖库：**

```
openai==1.3.0
streamlit==1.28.0
requests==2.31.0
pandas==2.1.0
faiss-cpu==1.7.4
langchain==0.1.0
pydantic==2.5.0
```

### 4.3 项目结构

```
TravelMate-AI/
├── README.md                 # 项目说明
├── requirements.txt          # 依赖清单
├── config/
│   ├── config.yaml          # 配置文件
│   └── prompts.py           # LLM提示词模板
├── data/
│   ├── attractions/         # 景点数据
│   │   ├── guangdong.json
│   │   ├── jiangsu.json
│   │   └── zhejiang.json
│   └── embeddings/          # 景点向量
├── src/
│   ├── agent/
│   │   ├── __init__.py
│   │   ├── core.py          # Agent核心
│   │   ├── dialogue.py      # 对话管理
│   │   └── state.py         # 状态管理
│   ├── tools/
│   │   ├── __init__.py
│   │   ├── weather.py       # 天气工具
│   │   ├── attraction.py    # 景点查询
│   │   ├── route.py         # 路线规划
│   │   └── budget.py        # 预算计算
│   ├── planner/
│   │   ├── __init__.py
│   │   ├── generator.py     # 行程生成器
│   │   └── optimizer.py     # 行程优化
│   └── utils/
│       ├── __init__.py
│       ├── llm.py           # LLM封装
│       └── helpers.py       # 辅助函数
└── tests/                   # 测试用例
    ├── test_agent.py
    └── test_tools.py
```

---

## 📊 数据需求

### 5.1 景点数据收集

**目标城市：**

- **广东省：** 广州、深圳、珠海、佛山（各50个景点）
- **江苏省：** 南京、苏州、无锡、扬州（各50个景点）
- **浙江省：** 杭州、宁波、绍兴、温州（各50个景点）

**数据来源：**

1. 携程/马蜂窝等网站爬取（合规使用）
2. 高德地图POI数据
3. 手动整理补充

**数据字段（见2.2.2）**

### 5.2 向量化处理

- 对景点描述进行embedding
- 使用FAISS建立索引
- 支持相似景点推荐

---

## 🧪 测试与验证

### 6.1 功能测试用例

| 测试场景 | 输入              | 期望输出           |
| -------- | ----------------- | ------------------ |
| 基础对话 | "我想去杭州玩3天" | 询问预算和偏好     |
| 信息补全 | 提供完整需求      | 生成3天行程        |
| 天气适配 | 雨天              | 推荐室内景点       |
| 预算控制 | 预算1000元/3天    | 选择经济型方案     |
| 偏好匹配 | "喜欢美食"        | 包含美食景点和餐厅 |

### 6.2 性能指标

- 对话响应时间：< 3秒
- 行程生成时间：< 10秒
- LLM token消耗：< 5000 tokens/次

### 6.3 用户验证

- 邀请5-10人试用
- 收集反馈问卷
- 迭代优化

---

## 📅 开发计划（10天）

### Day 1-2：环境搭建 + 数据准备

- ✅ 项目结构创建
- ✅ 依赖安装
- ✅ 景点数据收集（至少100条）
- ✅ 配置文件设置

### Day 3-4：Agent核心开发

- ✅ 对话管理器
- ✅ 状态跟踪
- ✅ LLM集成
- ✅ 提示词工程

### Day 5-6：工具链开发

- ✅ 天气API集成
- ✅ 景点查询功能
- ✅ 路线规划逻辑
- ✅ 预算计算

### Day 7-8：行程生成器

- ✅ 规划算法实现
- ✅ 输出格式化
- ✅ 优化调整

### Day 9：UI开发

- ✅ Streamlit界面
- ✅ 交互逻辑
- ✅ 样式美化

### Day 10：测试与文档

- ✅ 功能测试
- ✅ Bug修复
- ✅ 演示准备
- ✅ 文档完善

---

## 👥 团队分工

### 成员A：项目负责人 + Agent核心开发

**职责：**

- 项目架构设计
- Agent核心逻辑（dialogue.py, state.py, core.py）
- LLM集成与提示词工程
- 代码审查与集成

**工作量：** 30小时

**关键交付物：**

- Agent核心模块（Day 4）
- 提示词模板库（Day 4）

---

### 成员B：数据工程师 + 工具链开发

**职责：**

- 景点数据收集与清洗（200条）
- 景点数据向量化（FAISS）
- 天气API集成（weather.py）
- 景点查询工具（attraction.py）

**工作量：** 28小时

**关键交付物：**

- 景点数据库（Day 2）
- 天气查询工具（Day 5）
- 景点查询工具（Day 6）

---

### 成员C：算法工程师 + 行程规划

**职责：**

- 路线规划算法（route.py）
- 预算计算逻辑（budget.py）
- 行程生成算法（generator.py）
- 行程优化算法（optimizer.py）

**工作量：** 30小时

**关键交付物：**

- 路线规划工具（Day 6）
- 行程生成器（Day 8）

---

### 成员D：前端开发 + 测试

**职责：**

- 界面开发
- UI/UX设计与优化
- 功能测试与用例编写
- 用户文档编写

**工作量：** 26小时

**关键交付物：**

- 应用（Day 9）
- 测试报告（Day 10）
- 用户手册（Day 10）

---

## 🎯 项目亮点与创新

### 技术亮点

1. **Agent架构**：完整的感知-决策-执行闭环
2. **工具链设计**：模块化、可扩展的工具系统
3. **智能规划**：基于约束的行程优化算法
4. **向量检索**：FAISS实现相似景点推荐

### 业务创新

1. **对话式交互**：自然流畅的需求收集
2. **个性化推荐**：基于用户画像的定制化
3. **实时信息整合**：天气、距离等动态因素
4. **预算智能控制**：自动平衡花费

### 课程契合度

- ✅ AI应用实践（LLM + Agent）
- ✅ 软件工程（架构设计、模块化）
- ✅ 数据处理（爬虫、向量化）
- ✅ 产品思维（用户体验、实用性）

---

## 🔧 风险与应对

### 技术风险

| 风险          | 影响 | 应对措施                  |
| ------------- | ---- | ------------------------- |
| LLM API不稳定 | 高   | 添加重试机制、准备备用API |
| 数据收集困难  | 中   | 手动整理、降低数据量要求  |
| 算法复杂度高  | 中   | 简化为启发式算法          |

### 进度风险

| 风险          | 影响 | 应对措施                    |
| ------------- | ---- | --------------------------- |
| 功能scope过大 | 高   | 砍掉非核心功能（PDF导出等） |
| 成员时间冲突  | 中   | 每日同步、并行开发          |

---

## 📈 未来扩展方向

### V2.0功能

- 多目的地联合规划（跨省）
- 实时行程调整（基于实际情况）
- 用户评价反馈系统
- 社交分享功能

### V3.0功能

- 在线预订集成
- AI导游（语音交互）
- AR实景导航
- 多人协同规划

---

## 📚 参考资料

1. LangChain官方文档：https://python.langchain.com/
2. FAISS文档：https://github.com/facebookresearch/faiss
3. 和风天气API：https://dev.qweather.com/

---

**文档版本：** V1.0
**最后更新：** 2025-11-14
**文档维护人：** 项目组全体成员
